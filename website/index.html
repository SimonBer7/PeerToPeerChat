<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bernard's Chat</title>
    <!-- Add favicon -->
    <link rel="icon" type="image/png" href="./img/favicon.png">
    <!-- Add Tailwind CSS via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-blue-100 p-8 flex flex-col items-center">

    <h1 class="text-5xl font-bold mb-8 text-indigo-900">Bernard's Chat</h1>

    <!-- Container for message input and send button -->
    <div class="flex items-center mb-8">
        <input type="text" id="messageInput" class="mr-4 px-4 py-2 border rounded-md w-full bg-gray-100" placeholder="Type your message here..." required>
        <button type="submit" class="px-6 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Send Message</button>
    </div>

    <!-- Display messages -->
    <div id="messageList" class="bg-white p-6 rounded-md w-full h-150 overflow-y-auto">
        <!-- Message content will be displayed here -->
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
        <div class="text-gray-800">
            <strong>John</strong>: Hello there! <i class="text-gray-300">1629864060582</i>
        </div>
    </div>

    <script>
        // Function to send a message
        async function sendMessage(message) {
            const response = await fetch(`/send?message=${encodeURIComponent(message)}`);
            const result = await response.json();
            console.log(result);

            // Reload messages after sending a new message
            fetchMessages();
        }

        // Function to fetch and display messages
        async function fetchMessages() {
            const response = await fetch('/messages');
            const messages = await response.json();

            // Display messages in reverse order in the messageList div
            const messageList = document.getElementById('messageList');
            messageList.innerHTML = '';

            const messageIds = Object.keys(messages).reverse();
            for (const messageId of messageIds) {
                const message = messages[messageId];
                const messageElement = document.createElement('div');
                messageElement.innerHTML = " <strong>"+message.peer_id+"</strong>: "+message.message +" <i class='text-gray-300'>"+messageId+"</i>";
                messageList.appendChild(messageElement);
            }
        }

        // Attach event listener to the form for sending messages
        document.getElementById('sendMessageForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();

            if (message) {
                sendMessage(message);
                messageInput.value = '';
            }
        });

        // Fetch and display messages on page load
        fetchMessages();

        // Reload messages every three seconds
        setInterval(fetchMessages, 3000);

        // Add an example message to the message box
        window.onload = function() {
            const sampleMessage = "This is an example message. Hello world!";
            sendMessage(sampleMessage);
        };
    </script>
</body>
</html>
